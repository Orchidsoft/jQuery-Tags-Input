(function(e){var t=0;e.fn.doAutosize=function(t){var n=e(this).data("minwidth"),r=e(this).data("maxwidth"),i="",s=e(this),o=e("#"+e(this).data("tester_id"));if(i===(i=s.val())){return}var u=i.replace(/&/g,"&").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");o.html(u);var a=o.width(),f=a+t.comfortZone>=n?a+t.comfortZone:n,l=s.width(),c=f<l&&f>=n||f>n&&f<r;if(c){s.width(f)}};e.fn.resetAutosize=function(t){var n=e(this).data("minwidth")||t.minInputWidth||e(this).width(),r=e(this).data("maxwidth")||t.maxInputWidth||e(this).closest(".tagsinput").width()-t.inputPadding,i="",s=e(this),o=e("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:s.css("fontSize"),fontFamily:s.css("fontFamily"),fontWeight:s.css("fontWeight"),letterSpacing:s.css("letterSpacing"),whiteSpace:"nowrap"}),u=e(this).attr("id")+"_autosize_tester";if(!e("#"+u).length>0){o.attr("id",u);o.appendTo("body")}s.data("minwidth",n);s.data("maxwidth",r);s.data("tester_id",u);s.doAutosize(t)};e.fn.addTag=function(t,n){n=jQuery.extend({focus:false,callback:true},n);this.each(function(){var r=e(this).data("settings");var i=e(this).val().split(r.delimiter);if(i[0]==""){i=new Array}t=jQuery.trim(t);var s=false;if(n.unique){s=e(this).tagExist(t);if(s==true){e(r.fake_input).addClass("not_valid");if(r.onError){var o=r.onError;o.call(this,"duplicate")}}}if(r.validateTag){var o=r.validateTag;if(!o.call(this,t)){s=true;e(r.fake_input).addClass("not_valid");if(r.onError){var o=r.onError;o.call(this,"validation")}}}if(t!=""&&s!=true){if(r.onCreateTag){var u=e(r.onCreateTag(t));if(!u.hasClass("tag"))u.addClass("tag");u.find("[rel='remove']").attr({href:"#",title:r.removeText}).click(function(){return e(r.real_input).removeTag(escape(t))});u.insertBefore(r.input_wrapper)}else{e("<span>").addClass("tag").append(e("<span>").text(t).append("&nbsp;&nbsp;"),e("<a>",{href:"#",title:r.removeText,text:"x"}).click(function(){return e(r.real_input).removeTag(escape(t))})).insertBefore(r.input_wrapper)}i.push(t);e(r.fake_input).val("");if(n.focus){e(r.fake_input).focus()}else{e(r.fake_input).blur()}e.fn.tagsInput.updateTagsField(this,i);if(r.onAddTag){var o=r.onAddTag;o.call(this,t)}if(r.onChange){var a=i.length;var o=r.onChange;o.call(this,e(this),i[a-1])}}});return false};e.fn.removeTag=function(t){t=unescape(t);this.each(function(){var n=e(this).data("settings");var r=e(this).val().split(n.delimiter);e(n.holder+" .tag").remove();str="";for(i=0;i<r.length;i++){if(r[i]!=t){str=str+n.delimiter+r[i]}}e.fn.tagsInput.importTags(this,str);if(n.onRemoveTag){var s=n.onRemoveTag;s.call(this,t)}});return false};e.fn.clearTags=function(){this.each(function(){var t=e(this).data("settings");var n=e(this).val().split(t.delimiter);e(t.holder+" .tag").remove();e(this).val("");e.each(n,function(e,n){if(t.onRemoveTag){var r=t.onRemoveTag;r.call(this,n)}})})};e.fn.tagExist=function(t){var n=e(this).data("settings");var r=e(this).val().split(n.delimiter);return jQuery.inArray(t,r)>=0};e.fn.importTags=function(t){var n=e(this).data("settings");e(n.holder+" .tag").remove();e.fn.tagsInput.importTags(this,t)};e.fn.tagsInput=function(n){var r=jQuery.extend({interactive:true,defaultText:"add a tag",removeText:"Remove Tag",minChars:0,width:"auto",minHeight:"none",height:"auto",autocomplete:null,autocompleteselect:null,onlyautocomplete:false,hide:true,delimiter:",",unique:true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2,onChange:null,onAddTag:null,onRemoveTag:null,validateTag:null,onError:null,onCreateTag:null},n);this.each(function(){if(r.hide){e(this).hide()}var n=t++;var i=jQuery.extend({pid:n,real_input:this,holder:"#"+n+"_tagsinput",input_wrapper:"#"+n+"_addTag",fake_input:"#"+n+"_tag"},r);e(this).addClass("tagsinput_processed");var s='<div id="'+n+'_tagsinput" class="tagsinput"><div id="'+n+'_addTag" class="tagsinput_inputwrapper">';if(r.interactive){s=s+'<input id="'+n+'_tag" value="" data-default="'+r.defaultText+'" />'}s=s+'</div><div class="tags_clear"></div></div>';e(s).insertAfter(this);e(i.holder).css("width",r.width);e(i.holder).css("height",r.height);e(i.holder).css("min-height",r.minHeight);e(this).data("settings",i);if(e(this).val()!=""){e.fn.tagsInput.importTags(e(this),e(this).val())}if(r.interactive){e(i.fake_input).val(e(i.fake_input).attr("data-default"));e(i.fake_input).css("color",r.placeholderColor);e(i.fake_input).resetAutosize(r);e(i.holder).on("click",i,function(t){e(t.data.fake_input).focus()});e(i.fake_input).on("focus",i,function(t){if(e(t.data.fake_input).val()==e(t.data.fake_input).attr("data-default")){e(t.data.fake_input).val("")}e(t.data.fake_input).css("color","#000000");if(r.autocomplete){var n=e(t.data.fake_input).autocomplete("option","minLength");if(e(t.data.fake_input).val().length>=n){e(t.data.fake_input).autocomplete("search")}}});if(r.autocomplete){e(i.fake_input).autocomplete(r.autocomplete);if(r.autocompleteselect){e(i.fake_input).on("autocompleteselect",i,r.autocompleteselect)}else{e(i.fake_input).on("autocompleteselect",i,function(t,n){e(t.data.real_input).addTag(n.item.value,{focus:true,unique:r.unique});return false})}e(i.fake_input).on("autocompleteopen",i,function(){e(this).data("autocompleteopen",true);return false});e(i.fake_input).on("autocompleteclose",i,function(){e(this).data("autocompleteopen",null);return false})}e(i.fake_input).on("blur",i,function(t){if(e(t.data.fake_input).val()!=""&&e(t.data.fake_input).val()!=t.data.defaultText){if(!e(this).data("autocompleteopen")){if(t.data.onlyautocomplete==false&&t.data.minChars<=e(t.data.fake_input).val().length){if(e.fn.tagsInput.validateMaxChars(r,t))e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:true,unique:r.unique})}}else{}}else{e(t.data.fake_input).val(t.data.defaultText);e(t.data.fake_input).css("color",t.data.placeholderColor);e(t.data.fake_input).removeClass("not_valid");e(t.data.fake_input).resetAutosize(r)}return false});e(i.fake_input).on("paste",i,function(t){setTimeout(function(){var n=e(t.data.fake_input);var r=n.val();var i=new RegExp(t.data.delimiter,"g");r=r.replace(i,"");n.val(r)},0)});e(i.fake_input).on("keypress",i,function(t){if(t.which==t.data.delimiter.charCodeAt(0)||t.which==13){t.preventDefault();if(t.data.onlyautocomplete==false&&t.data.minChars<=e(t.data.fake_input).val().length){if(e.fn.tagsInput.validateMaxChars(r,t)){e(".ui-autocomplete").hide();e(t.data.fake_input).trigger("autocompleteclose",[i]);e(t.data.real_input).addTag(e(t.data.fake_input).val(),{focus:true,unique:r.unique});e(t.data.fake_input).resetAutosize(r)}}return false}else if(t.data.autosize){e(t.data.fake_input).doAutosize(r)}});e(i.fake_input).on("keydown",i,function(t){if(i.removeWithBackspace&&t.keyCode==8&&e(this).val()==""){t.preventDefault();var n=e(this).closest(".tagsinput").find(".tag:last").text();n=n.replace(/[\s]+x$/,"");e(i.real_input).removeTag(escape(n));e(this).trigger("focus")}if(t.keyCode==32&&t.ctrlKey){if(!e(this).data("autocompleteopen")){e(this).autocomplete("search")}}});e(i.fake_input).blur();if(i.unique||i.validateTag){e(i.fake_input).keydown(function(t){if(t.keyCode==8||String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){e(this).removeClass("not_valid")}})}}});return this};e.fn.tagsInput.updateTagsField=function(t,n){var r=e(t).data("settings");e(t).val(n.join(r.delimiter))};e.fn.tagsInput.importTags=function(t,n){var r=e(t).data("settings");e(t).val("");var s=n.split(r.delimiter);for(i=0;i<s.length;i++){e(t).addTag(s[i],{focus:false,callback:false})}if(r.onChange){var o=r.onChange;o.call(t,t,s[i])}};e.fn.tagsInput.validateMaxChars=function(t,n){var r=!n.data.maxChars||n.data.maxChars>=e(n.data.fake_input).val().length;if(!r){e(n.data.fake_input).addClass("not_valid");e(n.data.fake_input).css("width","100%");e(n.data.fake_input).parent(".tagsinput_inputwrapper").css("width","100%")}return r}})(jQuery)